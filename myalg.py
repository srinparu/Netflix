from __future__ import divisionimport pandas as pdimport numpy as nptraindata=pd.read_csv("output2.csv")array=traindata["movieid"].unique()array1=traindata["id"].unique()traind= (traindata.head(1000000))loaddata=pd.read_csv("movie_titles.csv",header = None, names = ['movieid', 'name'], usecols = [0,2],engine="python")pivottable=pd.pivot_table(traind,values="rating",index='id',columns='movieid').fillna(0)matrix=pivottable.as_matrix()col=matrix.transpose()mean=[]d={}for row in col:    #print (row)    sum=0    i=0    for element in row:        #print(element)        if(element!=0):           sum=sum+element           i=i+1    mean.append((sum/i))#meanframe=pd.DataFrame(mean,columns=pivottable.columns)columns=pivottable.columns#print(len(mean),len(columns))for each in range(len(columns)):    d[columns[each]]=mean[each]print (d)dataframe=[]deviation=[]for i in range(10):    user_data = traindata[traindata.id == array1[i]]    dataframe.append(user_data)def calculate(list, d):    meandeviation=[]    deviation = []    dict={}    movieframe = pd.DataFrame(list["movieid"]).reset_index()    movieid = movieframe["movieid"]    ratingframe = pd.DataFrame(list["rating"]).reset_index()    rating = ratingframe["rating"]    userid=list["id"].unique()    #print (userid)    for i in range(len(movieid)):        mid = movieid[i]        deviation.append(d[mid]-rating[i])    meandeviation.append([userid[0],np.mean(deviation)])    return (meandeviation[0],movieid,userid[0])std=[]dict={}compare=[]for i in range(len(dataframe)):    #print(i)    a,b,c=calculate(dataframe[i],d)    #print (a)    std.append(a)    dict[c]=b    #compare.append([c,b,d])#print (std)def computealgo(d,std,dict):    output=[]    for each in std:        for every in dict[each[0]]:            a=d[every]            output.append([a-each[1],a+each[1],each[0],every])    return (output)output=computealgo(d,std,dict)#print (output)#print (dataframe[0])preds=[]compare=[]for i in range(len(dataframe)):    pivot=pd.pivot_table(dataframe[0],values="rating",columns="movieid",index="id")    #print(pivot)    col=pivot.columns    d12=pivot.values    list=dataframe[0]    id=list["id"].unique()    #print(id)    for i in range(len(col)):        compare.append([col[i],d12[0][i],id[0]])    #print(compare)    out=output[:len(compare)]    #print(out)    for each in compare:        for ele in out:            if(each[0]==ele[3]):                if(ele[0]<=each[1]<=ele[1]):                    preds.append([each[1],d[each[0]],1])                else:                    preds.append([each[1],d[each[0]],0])print (preds ,len(preds))outputdataframe=pd.DataFrame(preds,columns=["rating","averagerating","predicted"])print (outputdataframe)outputdataframe.to_csv("out20.csv")